{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block extrahead %}
<style>
    .analytics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin: 20px 0;
    }
    .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .stat-number {
        font-size: 2.5em;
        font-weight: bold;
        margin: 10px 0;
    }
    .data-table {
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin: 20px 0;
    }
    .click-element {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        border-bottom: 1px solid #eee;
    }
    .click-element:last-child {
        border-bottom: none;
    }
    .click-count {
        background: #4CAF50;
        color: white;
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 0.9em;
        font-weight: bold;
    }
    .page-url {
        font-family: monospace;
        background: #f5f5f5;
        padding: 5px 10px;
        border-radius: 5px;
        margin: 5px 0;
    }
</style>
{% endblock %}

{% block content %}
<h1>{{ title }}</h1>

<div class="analytics-grid">
    <div class="stat-card">
        <div>📊 総ページビュー</div>
        <div class="stat-number">{{ stats.total_page_views }}</div>
    </div>
    
    <div class="stat-card">
        <div>👥 ユニークセッション</div>
        <div class="stat-number">{{ stats.unique_sessions }}</div>
    </div>
    
    <div class="stat-card">
        <div>🖱️ 総インタラクション</div>
        <div class="stat-number">{{ stats.total_interactions }}</div>
    </div>
    
    <div class="stat-card">
        <div>👆 クリック数</div>
        <div class="stat-number">{{ stats.click_events }}</div>
    </div>
</div>

<div class="analytics-grid">
    <div class="data-table">
        <h3>📈 人気ページ</h3>
        {% for page in popular_pages %}
        <div class="click-element">
            <div>
                <div class="page-url">{{ page.page_url }}</div>
            </div>
            <div class="click-count">{{ page.view_count }} views</div>
        </div>
        {% empty %}
        <p>データがありません</p>
        {% endfor %}
    </div>
    
    <div class="data-table">
        <h3>🎯 人気クリック要素</h3>
        {% for element in click_elements %}
        <div class="click-element">
            <div>
                <strong>{{ element.element_text|default:"(テキストなし)" }}</strong>
                <div style="font-size: 0.8em; color: #666;">{{ element.element_selector }}</div>
            </div>
            <div class="click-count">{{ element.click_count }}</div>
        </div>
        {% empty %}
        <p>データがありません</p>
        {% endfor %}
    </div>
</div>

<div class="data-table">
    <h3>🔧 プロジェクト情報</h3>
    <table style="width: 100%;">
        <tr>
            <th style="text-align: left; padding: 10px;">プロジェクト名</th>
            <td style="padding: 10px;">{{ project.name }}</td>
        </tr>
        <tr>
            <th style="text-align: left; padding: 10px;">トラッキングID</th>
            <td style="padding: 10px; font-family: monospace; background: #f5f5f5;">{{ project.tracking_id }}</td>
        </tr>
        <tr>
            <th style="text-align: left; padding: 10px;">対象ドメイン</th>
            <td style="padding: 10px;">{{ project.domain }}</td>
        </tr>
        <tr>
            <th style="text-align: left; padding: 10px;">作成日</th>
            <td style="padding: 10px;">{{ project.created_at|date:"Y年m月d日 H:i" }}</td>
        </tr>
        <tr>
            <th style="text-align: left; padding: 10px;">SDKコード</th>
            <td style="padding: 10px;">
                <textarea readonly style="width: 100%; height: 120px; font-family: monospace; background: #f8f8f8; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
<!-- LP Analytics SDK -->
<script src="https://your-domain.com/static/js/lp-analytics.js"></script>
<script>
const analytics = new LPAnalytics({
    trackingId: '{{ project.tracking_id }}',
    apiEndpoint: 'https://your-domain.com'
});
</script></textarea>
            </td>
        </tr>
    </table>
</div>

<div style="margin-top: 30px;">
    <a href="/admin/analytics/trackingproject/" class="button">← プロジェクト一覧に戻る</a>
    <a href="/analytics/api/dashboard/{{ project.id }}/heatmap_data/" class="button" target="_blank">📊 ヒートマップAPI</a>
    <a href="/analytics/api/dashboard/{{ project.id }}/scroll_data/" class="button" target="_blank">📜 スクロールAPI</a>
</div>

{% endblock %}